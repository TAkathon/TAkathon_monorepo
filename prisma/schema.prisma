// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// Enums
enum UserRole {
  student
  organizer
  sponsor
}

enum SkillCategory {
  frontend
  backend
  design
  data_science
  mobile
  devops
  product_management
  other
}

enum ProficiencyLevel {
  beginner
  intermediate
  advanced
  expert
}

enum HackathonStatus {
  draft
  registration_open
  registration_closed
  in_progress
  completed
  cancelled
}

enum ParticipantStatus {
  registered
  in_team
  withdrawn
}

enum TeamStatus {
  forming
  complete
  disbanded
}

enum TeamRole {
  captain
  member
}

enum InvitationStatus {
  pending
  accepted
  rejected
  expired
}

enum ApplicationStatus {
  pending
  accepted
  rejected
  waitlisted
}

enum SponsorshipTier {
  platinum
  gold
  silver
  bronze
  other
}

enum SponsorshipStatus {
  pending
  approved
  rejected
  paid
}

// Models

model User {
  id                  String    @id @default(uuid()) @db.Uuid
  email               String    @unique @db.VarChar(255)
  username            String    @unique @db.VarChar(50)
  passwordHash        String    @map("password_hash") @db.VarChar(255)
  fullName            String    @map("full_name") @db.VarChar(255)
  role                UserRole
  avatarUrl           String?   @map("avatar_url")
  bio                 String?
  githubUrl           String?   @map("github_url")
  linkedinUrl         String?   @map("linkedin_url")
  portfolioUrl        String?   @map("portfolio_url")
  organization        String?   @db.VarChar(255)
  organizationWebsite String?   @map("organization_website")
  createdAt           DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt           DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  studentProfile        StudentProfile?
  organizerProfile      OrganizerProfile?
  sponsorProfile        SponsorProfile?
  skills                UserSkill[]
  organizedHackathons   Hackathon[]            @relation("OrganizedHackathons")
  hackathonParticipants HackathonParticipant[]
  createdTeams          Team[]                 @relation("CreatedTeams")
  teamMemberships       TeamMember[]
  sentInvitations       TeamInvitation[]       @relation("SentInvitations")
  receivedInvitations   TeamInvitation[]       @relation("ReceivedInvitations")
  applications          Application[]
  sponsorships          Sponsorship[]

  @@index([email])
  @@index([username])
  @@index([role])
  @@map("users")
}

model StudentProfile {
  userId         String    @id @map("user_id") @db.Uuid
  university     String?   @db.VarChar(255)
  degree         String?   @db.VarChar(255)
  graduationYear Int?      @map("graduation_year")
  resumeUrl      String?   @map("resume_url")
  createdAt      DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt      DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("student_profiles")
}

model OrganizerProfile {
  userId           String    @id @map("user_id") @db.Uuid
  organizationName String    @map("organization_name") @db.VarChar(255)
  position         String?   @db.VarChar(255)
  createdAt        DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("organizer_profiles")
}

model SponsorProfile {
  userId      String    @id @map("user_id") @db.Uuid
  companyName String    @map("company_name") @db.VarChar(255)
  industry    String?   @db.VarChar(100)
  websiteUrl  String?   @map("website_url")
  logoUrl     String?   @map("logo_url")
  createdAt   DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt   DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sponsor_profiles")
}

model Skill {
  id          String   @id @default(uuid()) @db.Uuid
  name        String   @unique @db.VarChar(100)
  category    SkillCategory
  description String?
  createdAt   DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)

  userSkills UserSkill[]

  @@index([category])
  @@index([name])
  @@map("skills")
}

model UserSkill {
  id                String           @id @default(uuid()) @db.Uuid
  userId            String           @map("user_id") @db.Uuid
  skillId           String           @map("skill_id") @db.Uuid
  proficiencyLevel  ProficiencyLevel @map("proficiency_level")
  yearsOfExperience Int?             @map("years_of_experience")
  createdAt         DateTime?        @default(now()) @map("created_at") @db.Timestamptz(6)

  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  skill Skill @relation(fields: [skillId], references: [id], onDelete: Cascade)

  @@unique([userId, skillId])
  @@index([userId])
  @@index([skillId])
  @@map("user_skills")
}

model Hackathon {
  id                   String          @id @default(uuid()) @db.Uuid
  title                String          @db.VarChar(255)
  description          String
  organizerId          String          @map("organizer_id") @db.Uuid
  status               HackathonStatus @default(draft)
  startDate            DateTime        @map("start_date") @db.Timestamptz(6)
  endDate              DateTime        @map("end_date") @db.Timestamptz(6)
  registrationDeadline DateTime        @map("registration_deadline") @db.Timestamptz(6)
  location             String?
  isVirtual            Boolean         @default(false) @map("is_virtual")
  maxParticipants      Int?            @map("max_participants")
  maxTeamSize          Int             @default(5) @map("max_team_size")
  minTeamSize          Int             @default(2) @map("min_team_size")
  requiredSkills       String[]        @map("required_skills")
  prizePool            String?         @map("prize_pool")
  rules                String?
  bannerUrl            String?         @map("banner_url")
  websiteUrl           String?         @map("website_url")
  createdAt            DateTime?       @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt            DateTime?       @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  organizer    User                   @relation("OrganizedHackathons", fields: [organizerId], references: [id], onDelete: Cascade)
  participants HackathonParticipant[]
  teams        Team[]
  applications Application[]
  sponsorships Sponsorship[]

  @@index([organizerId])
  @@index([status])
  @@index([startDate])
  @@map("hackathons")
}

model HackathonParticipant {
  id           String            @id @default(uuid()) @db.Uuid
  hackathonId  String            @map("hackathon_id") @db.Uuid
  userId       String            @map("user_id") @db.Uuid
  status       ParticipantStatus @default(registered)
  teamId       String?           @map("team_id") @db.Uuid
  registeredAt DateTime?         @default(now()) @map("registered_at") @db.Timestamptz(6)

  hackathon Hackathon @relation(fields: [hackathonId], references: [id], onDelete: Cascade)
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([hackathonId, userId])
  @@index([hackathonId])
  @@index([userId])
  @@index([status])
  @@map("hackathon_participants")
}

model Team {
  id          String     @id @default(uuid()) @db.Uuid
  name        String     @db.VarChar(255)
  hackathonId String     @map("hackathon_id") @db.Uuid
  creatorId   String     @map("creator_id") @db.Uuid
  description String?
  status      TeamStatus @default(forming)
  maxSize     Int        @default(5) @map("max_size")
  currentSize Int        @default(1) @map("current_size")
  isPublic    Boolean    @default(true) @map("is_public")
  projectIdea String?    @map("project_idea")
  createdAt   DateTime?  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt   DateTime?  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  hackathon   Hackathon        @relation(fields: [hackathonId], references: [id], onDelete: Cascade)
  creator     User             @relation("CreatedTeams", fields: [creatorId], references: [id], onDelete: Cascade)
  members     TeamMember[]
  invitations TeamInvitation[]

  @@index([hackathonId])
  @@index([creatorId])
  @@index([status])
  @@map("teams")
}

model TeamMember {
  id       String    @id @default(uuid()) @db.Uuid
  teamId   String    @map("team_id") @db.Uuid
  userId   String    @map("user_id") @db.Uuid
  role     TeamRole
  joinedAt DateTime? @default(now()) @map("joined_at") @db.Timestamptz(6)

  team Team @relation(fields: [teamId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([teamId, userId])
  @@index([teamId])
  @@index([userId])
  @@map("team_members")
}

model TeamInvitation {
  id          String           @id @default(uuid()) @db.Uuid
  teamId      String           @map("team_id") @db.Uuid
  inviterId   String           @map("inviter_id") @db.Uuid
  inviteeId   String           @map("invitee_id") @db.Uuid
  status      InvitationStatus @default(pending)
  message     String?
  createdAt   DateTime?        @default(now()) @map("created_at") @db.Timestamptz(6)
  expiresAt   DateTime         @map("expires_at") @db.Timestamptz(6)
  respondedAt DateTime?        @map("responded_at") @db.Timestamptz(6)

  team    Team @relation(fields: [teamId], references: [id], onDelete: Cascade)
  inviter User @relation("SentInvitations", fields: [inviterId], references: [id], onDelete: Cascade)
  invitee User @relation("ReceivedInvitations", fields: [inviteeId], references: [id], onDelete: Cascade)

  @@index([teamId])
  @@index([inviteeId])
  @@index([status])
  @@map("team_invitations")
}

model Application {
  id          String            @id @default(uuid()) @db.Uuid
  hackathonId String            @map("hackathon_id") @db.Uuid
  userId      String            @map("user_id") @db.Uuid
  status      ApplicationStatus @default(pending)
  resumeUrl   String?           @map("resume_url")
  motivation  String?
  createdAt   DateTime?         @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt   DateTime?         @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  hackathon Hackathon @relation(fields: [hackathonId], references: [id], onDelete: Cascade)
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([hackathonId, userId])
  @@index([hackathonId])
  @@index([userId])
  @@index([status])
  @@map("applications")
}

model Sponsorship {
  id          String            @id @default(uuid()) @db.Uuid
  sponsorId   String            @map("sponsor_id") @db.Uuid
  hackathonId String            @map("hackathon_id") @db.Uuid
  tier        SponsorshipTier
  amount      Decimal           @db.Decimal(10, 2)
  status      SponsorshipStatus @default(pending)
  createdAt   DateTime?         @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt   DateTime?         @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  sponsor   User      @relation(fields: [sponsorId], references: [id], onDelete: Cascade)
  hackathon Hackathon @relation(fields: [hackathonId], references: [id], onDelete: Cascade)

  @@index([sponsorId])
  @@index([hackathonId])
  @@index([status])
  @@map("sponsorships")
}
